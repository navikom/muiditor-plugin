{"version":3,"file":"muiditor-plugin.min.js","sources":["MuiditorPlugin.js","index.js"],"sourcesContent":["\"use strict\";\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nexports.__esModule = true;\nvar PLUGIN_URL = 'https://api.muiditor.com/v1/plugin/token';\nexports.URL = 'https://muiditor.com';\nvar commonConfig = {\n    container: 'muiditor-plugin',\n    uid: 'client_uid',\n    secret: 'client_secret'\n};\nvar MuiditorPlugin = /** @class */ (function () {\n    function MuiditorPlugin(config) {\n        var _this = this;\n        this.onMessage = function (event) {\n            var data = JSON.parse(event.data);\n            if (event.origin !== exports.URL) {\n                return;\n            }\n            var payload = data[1];\n            switch (data[0]) {\n                case MuiditorPlugin.FRAME_READY:\n                    _this.performAction(MuiditorPlugin.FRAME_DATA_CONFIG, _this.config);\n                    break;\n                case MuiditorPlugin.LISTENER_ON_DATA:\n                    _this.config.onData && _this.config.onData(payload);\n                    break;\n                case MuiditorPlugin.LISTENER_ON_ERROR:\n                    _this.config.onError && _this.config.onError(payload);\n                    break;\n                case MuiditorPlugin.LISTENER_ON_SAVE_PROJECT:\n                    _this.config.onSaveProject && _this.config.onSaveProject(payload);\n                    break;\n                case MuiditorPlugin.LISTENER_ON_SAVE_COMPONENT:\n                    _this.config.onSaveComponent && _this.config.onSaveComponent(payload[0], payload[1]);\n                    break;\n                case MuiditorPlugin.LISTENER_ON_SWITCH_ORIENTATION:\n                    _this.config.onSwitchOrientation && _this.config.onSwitchOrientation(payload);\n                    break;\n                case MuiditorPlugin.LISTENER_ON_SWITCH_OS:\n                    _this.config.onSwitchOS && _this.config.onSwitchOS(payload);\n                    break;\n            }\n        };\n        this.config = Object.assign(commonConfig, config);\n    }\n    MuiditorPlugin.prototype.switchOrientation = function () {\n        this.performAction(MuiditorPlugin.FRAME_PRO_ACTION_SWITCH_ORIENTATION);\n    };\n    MuiditorPlugin.prototype.setIOSMode = function (value) {\n        this.performAction(MuiditorPlugin.FRAME_PRO_ACTION_SET_IOS, value);\n    };\n    MuiditorPlugin.prototype.switchAutoSave = function () {\n        this.performAction(MuiditorPlugin.FRAME_PRO_ACTION_SWITCH_AUTO_SAVE);\n    };\n    MuiditorPlugin.prototype.makeScreenshot = function () {\n        this.performAction(MuiditorPlugin.FRAME_PRO_ACTION_MAKE_SCREENSHOT);\n    };\n    MuiditorPlugin.prototype.setProject = function (data) {\n        this.performAction(MuiditorPlugin.FRAME_PRO_ACTION_SET_PROJECT, data);\n    };\n    MuiditorPlugin.prototype.performAction = function (action) {\n        var rest = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            rest[_i - 1] = arguments[_i];\n        }\n        this.postMessage.apply(this, __spreadArrays([action], rest));\n    };\n    MuiditorPlugin.prototype.getToken = function (uid, secret) {\n        var config = {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded'\n            },\n            body: \"grant_type=password&uid=\" + uid + \"&secret=\" + secret\n        };\n        return fetch(new Request(PLUGIN_URL, config)).then(function (response) { return response.text(); });\n    };\n    MuiditorPlugin.prototype.startEditor = function (token) {\n        if (!token.length) {\n            alert('The token is empty');\n            return;\n        }\n        this.makeFrame(token, MuiditorPlugin.TYPE_EDITOR);\n    };\n    MuiditorPlugin.prototype.startViewer = function (token) {\n        if (!token.length) {\n            alert('The token is empty');\n            return;\n        }\n        this.makeFrame(token, MuiditorPlugin.TYPE_VIEWER);\n    };\n    MuiditorPlugin.prototype.makeFrame = function (token, type) {\n        var container = document.getElementById(this.config.container);\n        var frame = document.createElement('iframe');\n        frame.src = exports.URL + \"/\" + type + \"?token=\" + token;\n        frame.id = type;\n        window.addEventListener('message', this.onMessage, false);\n        container && container.appendChild(frame);\n        this.frame = frame;\n    };\n    MuiditorPlugin.prototype.postMessage = function (action) {\n        var message = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            message[_i - 1] = arguments[_i];\n        }\n        console.log('postMessage=======', action);\n        this.frame && this.frame.contentWindow.postMessage(JSON.stringify(__spreadArrays([action], message)), '*');\n    };\n    MuiditorPlugin.prototype.dispose = function () {\n        window.removeEventListener('message', this.onMessage, false);\n    };\n    MuiditorPlugin.FRAME_READY = 'frame_ready';\n    MuiditorPlugin.LISTENER_ON_DATA = 'editor_on_data';\n    MuiditorPlugin.LISTENER_ON_SAVE_PROJECT = 'editor_on_save_project';\n    MuiditorPlugin.LISTENER_ON_SAVE_COMPONENT = 'editor_on_save_component';\n    MuiditorPlugin.LISTENER_ON_SWITCH_ORIENTATION = 'on_switch_orientation';\n    MuiditorPlugin.LISTENER_ON_SWITCH_OS = 'on_switch_os';\n    MuiditorPlugin.LISTENER_ON_ERROR = 'on_error';\n    MuiditorPlugin.FRAME_DATA_CONFIG = 'config';\n    MuiditorPlugin.FRAME_PRO_ACTION_SWITCH_ORIENTATION = 'switch_orientation';\n    MuiditorPlugin.FRAME_PRO_ACTION_SET_IOS = 'set_ios';\n    MuiditorPlugin.FRAME_PRO_ACTION_SWITCH_AUTO_SAVE = 'switch_auto_save';\n    MuiditorPlugin.FRAME_PRO_ACTION_SET_PROJECT = 'set_project';\n    MuiditorPlugin.FRAME_PRO_ACTION_MAKE_SCREENSHOT = 'make_screenshot';\n    MuiditorPlugin.TYPE_EDITOR = 'editor';\n    MuiditorPlugin.TYPE_VIEWER = 'viewer';\n    return MuiditorPlugin;\n}());\nexports[\"default\"] = MuiditorPlugin;\n//# sourceMappingURL=MuiditorPlugin.js.map","\"use strict\";\nexports.__esModule = true;\nvar MuiditorPlugin_1 = require(\"./MuiditorPlugin\");\nexports[\"default\"] = MuiditorPlugin_1[\"default\"];\nObject.assign(module.exports, MuiditorPlugin_1[\"default\"], MuiditorPlugin_1.URL);\n//# sourceMappingURL=index.js.map"],"names":["__spreadArrays","this","s","i","il","arguments","length","r","Array","k","a","j","jl","exports","commonConfig","container","uid","secret","MuiditorPlugin","config","_this","onMessage","event","data","JSON","parse","origin","URL","payload","FRAME_READY","performAction","FRAME_DATA_CONFIG","LISTENER_ON_DATA","onData","LISTENER_ON_ERROR","onError","LISTENER_ON_SAVE_PROJECT","onSaveProject","LISTENER_ON_SAVE_COMPONENT","onSaveComponent","LISTENER_ON_SWITCH_ORIENTATION","onSwitchOrientation","LISTENER_ON_SWITCH_OS","onSwitchOS","Object","assign","prototype","switchOrientation","FRAME_PRO_ACTION_SWITCH_ORIENTATION","setIOSMode","value","FRAME_PRO_ACTION_SET_IOS","switchAutoSave","FRAME_PRO_ACTION_SWITCH_AUTO_SAVE","makeScreenshot","FRAME_PRO_ACTION_MAKE_SCREENSHOT","setProject","FRAME_PRO_ACTION_SET_PROJECT","action","rest","_i","postMessage","apply","getToken","fetch","Request","method","headers","body","then","response","text","startEditor","token","makeFrame","TYPE_EDITOR","alert","startViewer","TYPE_VIEWER","type","document","getElementById","frame","createElement","src","id","window","addEventListener","appendChild","message","console","log","contentWindow","stringify","dispose","removeEventListener","MuiditorPlugin_1","module"],"mappings":"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"}